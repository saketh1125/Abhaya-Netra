<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="#121212"
    tools:context=".MainActivity">

    <!-- 1. Top App Bar -->
    <com.google.android.material.appbar.AppBarLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:background="#1E1E1E">

        <com.google.android.material.appbar.MaterialToolbar
            android:id="@+id/topAppBar"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:minHeight="?attr/actionBarSize"
            app:title="@string/app_name"
            app:subtitle="@string/app_subtitle"
            app:titleTextColor="#FFFFFF"
            app:subtitleTextColor="#B0BEC5" />

    </com.google.android.material.appbar.AppBarLayout>

    <!-- 2. Main Content -->
    <androidx.core.widget.NestedScrollView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:layout_behavior="@string/appbar_scrolling_view_behavior">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp"
            android:clipToPadding="false">

            <!-- Trust Badges (Chips) -->
            <com.google.android.material.chip.ChipGroup
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="16dp">

                <com.google.android.material.chip.Chip
                    android:id="@+id/chipOfflineStatus"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="@string/status_offline"
                    android:textColor="#FFFFFF"
                    app:chipBackgroundColor="#263238"
                    app:chipStrokeColor="#455A64"
                    app:chipStrokeWidth="1dp"
                    style="@style/Widget.Material3.Chip.Assist"
                    android:clickable="false" />

                <com.google.android.material.chip.Chip
                    android:id="@+id/chipOnDevice"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="@string/status_on_device"
                    android:textColor="#FFFFFF"
                    app:chipBackgroundColor="#1B5E20"
                    app:chipStrokeColor="#2E7D32"
                    app:chipStrokeWidth="1dp"
                    style="@style/Widget.Material3.Chip.Assist"
                    android:clickable="false" />

            </com.google.android.material.chip.ChipGroup>

            <!-- A. Primary Score Card -->
            <com.google.android.material.card.MaterialCardView
                android:id="@+id/cardScore"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="16dp"
                app:cardBackgroundColor="#1E1E1E"
                app:cardCornerRadius="24dp"
                app:strokeColor="#333333"
                app:strokeWidth="1dp">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:padding="24dp">

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="@string/label_probability"
                        android:textColor="#B0BEC5"
                        android:textStyle="bold"
                        android:letterSpacing="0.05"
                        android:textAllCaps="true"
                        android:textSize="12sp" />

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="horizontal"
                        android:gravity="center_vertical"
                        android:layout_marginTop="8dp">

                        <TextView
                            android:id="@+id/tvScorePercent"
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="0%"
                            android:textSize="48sp"
                            android:textStyle="bold"
                            android:textColor="#FFFFFF"
                            android:fontFamily="monospace" />

                        <Space
                            android:layout_width="16dp"
                            android:layout_height="wrap_content" />

                        <LinearLayout
                            android:layout_width="0dp"
                            android:layout_height="wrap_content"
                            android:layout_weight="1"
                            android:orientation="vertical">

                            <TextView
                                android:id="@+id/tvRiskLabel"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="WAITING..."
                                android:textColor="#B0BEC5"
                                android:textStyle="bold"
                                android:textSize="16sp" />

                            <com.google.android.material.progressindicator.LinearProgressIndicator
                                android:id="@+id/progressRisk"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:progress="0"
                                app:trackColor="#333333"
                                app:indicatorColor="#B0BEC5" />
                        </LinearLayout>
                    </LinearLayout>

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="@string/label_inference_note"
                        android:textColor="#757575"
                        android:textSize="12sp"
                        android:layout_marginTop="8dp" />

                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <!-- B. Session Analytics -->
            <com.google.android.material.card.MaterialCardView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="24dp"
                app:cardBackgroundColor="#1E1E1E"
                app:cardCornerRadius="16dp"
                app:strokeColor="#333333"
                app:strokeWidth="1dp">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:padding="16dp">

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="@string/label_session_stats"
                        android:textColor="#B0BEC5"
                        android:textSize="12sp"
                        android:textStyle="bold"
                        android:layout_marginBottom="12dp" />

                    <TextView
                        android:id="@+id/sessionSummaryTextView"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:text="Waiting for analysis..."
                        android:textColor="#E0E0E0"
                        android:fontFamily="monospace"
                        android:textSize="12sp"
                        android:lineSpacingExtra="4dp" />

                    <!-- Hidden status text view required for compatibility with MainActivity logic -->
                    <TextView
                        android:id="@+id/statusTextView"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:visibility="gone" />

                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <!-- DEBUG STATS PANEL (Developer Visibility) -->
            <TextView
                android:id="@+id/tvDebugStats"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="16dp"
                android:padding="12dp"
                android:background="#80000000"
                android:text="DEBUG: Waiting..."
                android:textColor="#00FF00"
                android:fontFamily="monospace"
                android:textSize="10sp"
                android:lineSpacingExtra="2dp" />

            <!-- C. Actions -->
            <Button
                android:id="@+id/btnSelectVideo"
                android:layout_width="match_parent"
                android:layout_height="64dp"
                android:text="@string/action_select_video"
                android:layout_marginBottom="12dp"
                app:backgroundTint="#424242"
                app:cornerRadius="16dp" />
            
            <!-- Stop button (Optional, mapped if needed, else placebo for now) -->
            <!-- Using existing IDs only, so we skip adding new Logic-requiring buttons for now -->

            <!-- D. Developer Mode (Collapsible) -->
            <com.google.android.material.card.MaterialCardView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="24dp"
                android:layout_marginBottom="16dp"
                app:cardBackgroundColor="#121212"
                app:strokeColor="#333333"
                app:strokeWidth="1dp"
                app:cardCornerRadius="12dp">

                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="vertical"
                    android:padding="16dp">

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="@string/dev_section_title"
                        android:textColor="#B0BEC5"
                        android:textStyle="bold"
                        android:textSize="14sp" />

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="@string/dev_section_desc"
                        android:textColor="#757575"
                        android:textSize="12sp"
                        android:layout_marginBottom="16dp" />

                    <Button
                        android:id="@+id/btnLiveCamera"
                        style="@style/Widget.Material3.Button.OutlinedButton"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:text="@string/action_enable_live_cam"
                        android:textColor="#B0BEC5"
                        app:strokeColor="#546E7A" />

                    <!-- Settings Toggle Button - OUTSIDE of developerContainer so it's always accessible -->
                    <Button
                        android:id="@+id/btnSettings"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:text="Adjust Thresholds"
                        android:layout_marginTop="8dp"
                        style="@style/Widget.Material3.Button.TextButton"/>

                    <!-- Hidden Container for Live Tools -->
                    <LinearLayout
                        android:id="@+id/developerContainer"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="vertical"
                        android:visibility="gone"
                        android:layout_marginTop="16dp">

                        <TextView
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="@string/dev_warning"
                            android:textColor="#FFB74D"
                            android:textSize="12sp"
                            android:layout_marginBottom="8dp"
                            android:layout_gravity="center_horizontal"/>
                        
                        <androidx.constraintlayout.widget.ConstraintLayout
                            android:layout_width="match_parent"
                            android:layout_height="300dp"
                            android:background="#000000">

                            <androidx.camera.view.PreviewView
                                android:id="@+id/viewFinder"
                                android:layout_width="match_parent"
                                android:layout_height="match_parent" />
                                
                            <ImageView
                                android:id="@+id/facePreview"
                                android:layout_width="80dp"
                                android:layout_height="80dp"
                                android:layout_margin="16dp"
                                android:background="#33FF0000"
                                android:scaleType="fitCenter"
                                app:layout_constraintEnd_toEndOf="parent"
                                app:layout_constraintTop_toTopOf="parent" />

                        </androidx.constraintlayout.widget.ConstraintLayout>

                    </LinearLayout>
                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <!-- Footer -->
            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="@string/footer_build_info"
                android:gravity="center"
                android:textColor="#424242"
                android:textSize="10sp"
                android:layout_marginTop="32dp" />

        </LinearLayout>
    </androidx.core.widget.NestedScrollView>

    <!-- Settings Overlay (Hidden) - Keeping mostly same structure but Materialized -->
    <ScrollView
        android:id="@+id/settingsPanel"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_gravity="bottom"
        android:background="#1E1E1E"
        android:padding="24dp"
        android:visibility="gone"
        android:elevation="100dp">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Detection Settings"
                android:textSize="20sp"
                android:textStyle="bold"
                android:textColor="#FFFFFF"
                android:layout_marginBottom="24dp" />

            <!-- Re-include identical IDs for logic preservation -->
            <TextView android:id="@+id/lblSmoothing" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Smoothing Window: 15" android:textColor="#FFFFFF" />
            <SeekBar android:id="@+id/sliderSmoothing" android:layout_width="match_parent" android:layout_height="wrap_content" android:max="40" android:min="5" android:progress="15" android:layout_marginBottom="16dp" />

            <TextView android:id="@+id/lblLowRisk" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Low Risk Max: 0.35" android:textColor="#FFFFFF" />
            <SeekBar android:id="@+id/sliderLowRisk" android:layout_width="match_parent" android:layout_height="wrap_content" android:max="50" android:min="20" android:progress="35" android:layout_marginBottom="16dp" />

            <TextView android:id="@+id/lblHighRisk" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="High Risk Min: 0.65" android:textColor="#FFFFFF" />
            <SeekBar android:id="@+id/sliderHighRisk" android:layout_width="match_parent" android:layout_height="wrap_content" android:max="90" android:min="50" android:progress="65" android:layout_marginBottom="16dp" />
            
            <Switch android:id="@+id/switchHysteresis" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Enable Hysteresis" android:textColor="#FFFFFF" android:checked="true" android:layout_marginBottom="24dp" />

            <Button android:id="@+id/btnResetSettings" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Reset to Defaults" style="@style/Widget.Material3.Button.TonalButton" android:layout_marginBottom="8dp" />
            <Button android:id="@+id/btnCloseSettings" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Close" />

        </LinearLayout>
    </ScrollView>

    <!-- Legacy Trust Badges Container (Hidden/Stub) -->
    <!-- We moved logic to Chips, but app might crash if it can't find these until we update Kotlin. 
         Wait, I can just update Kotlin concurrently. 
         Better compliance: I will remove them here and update Kotlin in the next step to reference the Chips. -->
         
    <!-- Legacy Visual Risk Indicator (Banner) (Hidden/Stub) -->
    <!-- Replaced by Card logic. Will update Kotlin to use cardScore. -->
    <androidx.constraintlayout.widget.ConstraintLayout
        android:id="@+id/riskBannerLayout"
        android:layout_width="0dp"
        android:layout_height="0dp"
        android:visibility="gone"/>
     
    <!-- Legacy IDs required to prevent immediate crash before Kotlin update if looking for specific view types? 
         No, findViewById returns null or throws? It throws NPE if we assume non-null !! or lateint.
         MainActivity uses findViewById<T>(...).
         I will update Kotlin IMMEDIATELY after this. -->

</androidx.coordinatorlayout.widget.CoordinatorLayout>
